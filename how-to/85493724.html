<!--
title: Amazon Web Services: Deploying a new live version of AWS BVI
description: 
published: true
date: 2020-12-02T14:32:03.786Z
tags: 
editor: ckeditor
dateCreated: 2020-12-02T12:00:06.728Z
-->

<h1>Blueberry Group : Amazon Web Services: Deploying a new live version of AWS BVI&nbsp;</h1>
<p>Created by Jason Cozza on Nov 24, 2020</p>
<h2>Checking Lambda:</h2>
<p>Before deploying a new live version, the lambdas need the following checks:</p>
<ul>
  <li>Cognito_BVI_Post_Authentication_Python<ul>
      <li>Check if every SQL query are functional.</li>
    </ul>
  </li>
  <li>Cognito_BVI_Pre_Sign_up_Python<ul>
      <li>Check if every SQL query are functional.</li>
    </ul>
  </li>
</ul>
<p>Note: <strong>Grabcut</strong> and <strong>BVI engine</strong> are also using SQL so they need a check as well.</p>
<h2>Test Run:</h2>
<p>Once all lambdas have been checked and change to use the next live values. A full test is required and any critical fail need fixing.</p>
<p>For this it is best to double check that all API Gateway end points are using the correct Lambda on the beta stage.</p>
<h2>Deploying a new live version:</h2>
<p>Once the future version has passed the test program, create a new version of the lambdas and stage using the instruction at the following link: <a href="https://wiki.bbconsult.co.uk/display/BLUEB/Amazon+Web+Services%3A+Deploying+a+stable+stage+of+an+API+gateway+calling+Lambda">https://wiki.bbconsult.co.uk/display/BLUEB/Amazon+Web+Services%3A+Deploying+a+stable+stage+of+an+API+gateway+calling+Lambda</a></p>
<p>The new stage should be named “app_test_” followed by the release date. Ex: ‘app_test_17_02_17’.</p>
<p>Once the API deployed reverse all method to use the latest lambda to avoid having to do so when deploying the next time to beta.</p>
<p>Then make a copy of the swagger file and rename it to contain the new stage name.</p>
<p>The next step is to update the app_test usage Plan:</p>
<ul>
  <li>Go to Usage Plans</li>
  <li>Select the usage plan you want to add to stage to.</li>
  <li>Under "Associated API Stages" choose the BVI Web Service API for the API and then choose the new created Stage.</li>
</ul>
<figure class="image"><img src="attachments/85493724/85493726.png"></figure>
<figure class="image"><img src="attachments/85493724/85493725.png"></figure>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>Attachments:</h2>
<figure class="image"><img src="images/icons/bullet_blue.gif" alt=""></figure>
<p><a href="attachments/85493724/85493725.png">Usage Plan Stage.png</a> (image/png)&nbsp;<br>&nbsp;</p>
<figure class="image"><img src="images/icons/bullet_blue.gif" alt=""></figure>
<p><a href="attachments/85493724/85493726.png">Usage Plan.png</a> (image/png)&nbsp;<br>&nbsp;</p>
<p>Document generated by Confluence on Dec 02, 2020 11:32</p>
<p><a href="http://www.atlassian.com/">Atlassian</a></p>
