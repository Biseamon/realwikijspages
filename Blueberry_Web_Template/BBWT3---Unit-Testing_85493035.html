<!--
title: BBWT3---Unit-Testing_85493035
description: 
published: true
date: 2020-12-01T16:49:32.887Z
tags: 
editor: undefined
dateCreated: 2020-11-27T11:07:28.659Z
-->

<!DOCTYPE html>
<html>
    <head>
        <title>Blueberry Group : BBWT3 - Unit Testing</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Blueberry Group</a></span>
                            </li>
                                                    <li>
                                <span><a href="Blueberry-Web-Template_85492520.html">Blueberry Web Template</a></span>
                            </li>
                                                    <li>
                                <span><a href="BBWT3_85492530.html">BBWT3</a></span>
                            </li>
                                                    <li>
                                <span><a href="BBWT3---Development-Environment_85493024.html">BBWT3 - Development Environment</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Blueberry Group : BBWT3 - Unit Testing
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Jason Cozza</span> on Sep 21, 2020
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h1 id="BBWT3-UnitTesting-Overview">Overview</h1><p>Here we look at how to perform both front and back-end test with examples. For more information please refer to the useful resources section on this page.</p><h1 id="BBWT3-UnitTesting-BackendUnitTests">Backend Unit Tests</h1><p>For backend testing we use xUnit. Tests can be found within the bbwt3/test/BBWT.Services.Test folder.</p><h2 style="margin-left: 30.0px;" id="BBWT3-UnitTesting-UsefulResources">Useful Resources</h2><p style="margin-left: 30.0px;">You can learn more about this tool with an example <a class="external-link" href="https://xunit.github.io/docs/getting-started-dotnet-core" rel="nofollow">here</a>.</p><h2 style="margin-left: 30.0px;" id="BBWT3-UnitTesting-CreatingTests">Creating Tests</h2><p style="margin-left: 30.0px;">To create a test for a service, first of all it is necessary to add to Tests project a new class. For example if we want to test RoleService, we create class RoleServiceTest.</p><p style="margin-left: 30.0px;">After this, it is necessary to select a method which we want to test. For example RoleService.Save. For this method we create our test method which will have [Fact] attribute.</p><p style="margin-left: 30.0px;">In BBWT3 we use AAA unit test pattern:</p><ul><li style="list-style-type: none;background-image: none;"><ul><li><strong>Arrange: </strong>Setup everything needed for the running the tested code. This includes any initialization of dependencies, mocks and data needed for the test to run.</li><li><strong>Act: </strong>Invoke the code under test.</li><li><strong>Assert:</strong> Specify the pass criteria for the test, which it fails if not met.</li></ul></li></ul><p style="margin-left: 30.0px;">In Arrange section of code we create an instance of the service object which we want to test from BBWT.Services project - in our example it is RoleService.</p><p style="margin-left: 30.0px;">Dependent Injection is not working here because test project is separate from BBWT.Server (where we use ASP.NET Core IServiceCollection object to register dependencies).</p><p style="margin-left: 30.0px;"><br/></p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p><code>[Fact]</code><br/><code>public</code> <code>async Task Save_New_User()</code><br/><code>{</code><br/><code>    </code><code>using</code> <code>(var ctx = GetSutContext())</code><br/><code>    </code><code>{</code><br/><code>        </code><code>// Arrange</code><br/><code>        </code><code>var userDto = GetEntity();</code><br/><code>        </code><code>var sut = GetSutService(ctx);</code><br/> <br/><code>        </code><code>// Act</code><br/><code>        </code><code>userDto.Id = GetId(await sut.Save(userDto, CancellationToken.None));</code><br/> <br/><code>        </code><code>var user = ctx.Set&lt;User&gt;().FirstOrDefault(u =&gt; u.Email == userDto.Email);</code><br/> <br/><code>        </code><code>// Assert</code><br/><code>        </code><code>Assert.NotNull(user);</code><br/><code>        </code><code>Assert.Equal(user.Id, userDto.Id);</code><br/><code>        </code><code>Assert.Equal(user.Email, userDto.Email);</code><br/><code>    </code><code>}</code><br/><code>}</code></p></td></tr></tbody></table></div><h1 style="margin-left: 30.0px;" id="BBWT3-UnitTesting-ThereAreTwoWaysofRunningBack-EndTests">There Are Two Ways of Running Back-End Tests</h1><h2 style="margin-left: 30.0px;" id="BBWT3-UnitTesting-UsingConsole">Using Console</h2><p>There is some additional requirements - it is necessary to modify the BBWT.Services.Test.csproj file and add a reference to dotnet-xunit CLI tool (according to xunit.gitlab reference above):</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p><code class="csharp plain">&lt;DotNetCliToolReference Include=</code><code class="csharp string">&quot;dotnet-xunit&quot;</code> <code class="csharp plain">Version=</code><code class="csharp string">&quot;2.3.0-beta2-build3683&quot;</code> <code class="csharp plain">/&gt;</code></p></td></tr></tbody></table></div><p><br/></p><p style="margin-left: 30.0px;">Switch to test folder, choose a test project and use dotnet test to run xUnit tests:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p><code class="csharp plain">cd tests/BBWT.Services.Test</code><br/> <br/><code class="csharp plain">dotnet test</code></p></td></tr></tbody></table></div><h2 style="margin-left: 30.0px;" id="BBWT3-UnitTesting-UsingVisualStudio">Using Visual Studio</h2><p style="margin-left: 30.0px;">Use the Tests &gt; Run &gt; All tests main menu item or press Ctrl+R, A to run all tests.</p><p style="margin-left: 30.0px;"><span class="confluence-embedded-file-wrapper"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/85493035/85493036.png" data-image-src="attachments/85493035/85493036.png" data-unresolved-comment-count="0" data-linked-resource-id="85493036" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="vs2017-testing.png" data-base-url="https://wiki.bbconsult.co.uk" data-linked-resource-content-type="image/png" data-linked-resource-container-id="85493035" data-linked-resource-container-version="1"></span></span></p><h1 id="BBWT3-UnitTesting-FrontendUnitTests-Jasmine/Karma">Frontend Unit Tests - Jasmine/Karma</h1><h2 style="margin-left: 30.0px;" id="BBWT3-UnitTesting-WritingFrontendTests">Writing Frontend Tests</h2><p style="margin-left: 30.0px;">Please locate your test nearby components/services being covered with it and use *.spec.ts suffix as follows:</p><p style="margin-left: 30.0px;"><span class="confluence-embedded-file-wrapper"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/85493035/85493037.png" data-image-src="attachments/85493035/85493037.png" data-unresolved-comment-count="0" data-linked-resource-id="85493037" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="spec-file-correct-location.png" data-base-url="https://wiki.bbconsult.co.uk" data-linked-resource-content-type="image/png" data-linked-resource-container-id="85493035" data-linked-resource-container-version="1"></span></span></p><p style="margin-left: 30.0px;"><br/></p><p style="margin-left: 30.0px;">For a new test it is necessary to add a new typescript file to src/tests folder. Name convention is &lt;component_name&gt;.component.spec.ts.</p><p style="margin-left: 30.0px;">Word &quot;spec&quot; is important because in boot-tests.ts there is a certain file pattern for tests:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p><code class="csharp keyword">const</code> <code class="csharp plain">context = require.context(</code><code class="csharp string">'../'</code><code class="csharp plain">, </code><code class="csharp keyword">true</code><code class="csharp plain">, /\.spec\.ts$/);</code></p></td></tr></tbody></table></div><p style="margin-left: 30.0px;">This means that the file with tests must contain the word &quot;spec&quot;.</p><p style="margin-left: 30.0px;"><br/></p><p style="margin-left: 30.0px;">Test file must contain code which performs the test. The simplest test is:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p><code class="js plain">describe(</code><code class="js string">'Sample Test'</code><code class="js plain">, () =&gt; {</code><br/><code class="js plain">it(</code><code class="js string">'true is true'</code><code class="js plain">, () =&gt; expect(</code><code class="js keyword">true</code><code class="js plain">).toBe(</code><code class="js keyword">true</code><code class="js plain">));</code><br/><code class="js plain">});</code></p></td></tr></tbody></table></div><p class="auto-cursor-target">Here's what we expect, and here's what actually happened. To test services or components, it's necessary to inject them into the test code.</p><h2 style="margin-left: 30.0px;" id="BBWT3-UnitTesting-RunningFrontendTests">Running Frontend Tests</h2><p><br/>GitLab will automatically test the project on new commits, if the branch is either &quot;develop&quot;, or prefixed with &quot;feature/&quot; or &quot;fix/&quot;. It does this via a headless version of Chrome.</p><p><br/></p><p style="margin-left: 30.0px;">Frontend tests require that Chrome is installed.</p><p style="margin-left: 30.0px;">Switch to project/BBWT.Client folder and run npm test command:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p><code class="csharp plain">cd project/BBWT.Client</code><br/> <br/><code class="csharp plain">npm test</code></p></td></tr></tbody></table></div><p style="margin-left: 30.0px;"><br/></p><p style="margin-left: 30.0px;">If this does not work, then make sure that the karma start src/test/karma.conf.js command is declared in package.json file under scripts section with corresponding test key value:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p><code class="csharp string">&quot;scripts&quot;</code><code class="csharp plain">: {</code><br/><code class="csharp spaces">   </code><code class="csharp string">&quot;test&quot;</code><code class="csharp plain">: </code><code class="csharp string">&quot;karma start src/test/karma.conf.js&quot;</code><br/><code class="csharp plain">},</code></p></td></tr></tbody></table></div><p style="margin-left: 30.0px;"><br/></p><p style="margin-left: 30.0px;">Or run karma test-runner with parameters and config you need:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p><code class="csharp plain">karma start src/test/karma.conf.js</code></p></td></tr></tbody></table></div><p>At the end of the process we can see in CMD the result of the tests.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="36" src="attachments/85493035/85493038.png" data-image-src="attachments/85493035/85493038.png" data-unresolved-comment-count="0" data-linked-resource-id="85493038" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2017-6-9_20-18-24.png" data-base-url="https://wiki.bbconsult.co.uk" data-linked-resource-content-type="image/png" data-linked-resource-container-id="85493035" data-linked-resource-container-version="1"></span></span></p><p><br/></p>
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/85493035/85493036.png">vs2017-testing.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/85493035/85493037.png">spec-file-correct-location.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/85493035/85493038.png">image2017-6-9_20-18-24.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                 
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Nov 27, 2020 10:56</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
