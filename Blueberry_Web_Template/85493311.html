<!--
title: A1:2017- Injection
description: 
published: true
date: 2020-12-02T14:56:31.033Z
tags: 
editor: undefined
dateCreated: 2020-11-27T11:01:08.994Z
-->

<h1>Blueberry Group : A1:2017- Injection&nbsp;</h1>
<p>Created by Jason Cozza on Sep 22, 2020</p>
<h1>Overview</h1>
<p>The number 1 threat identified by the OWASP (Open Web Application Security Project) is injection of arbitrary code. If your application is able to receive user input that goes into a back-end database, command, or call, your app is able to fall to the face of code injection attacks. Injection flaws are a set of security vulnerabilities which occur when suspicious data is inserted into an app as a command or query. Known injection attacks include SQL, OS, XXE, and LDAP.</p>
<p>The most common of the code injection attacks are SQL Injections, also known as SQLi. An SQLi attack is done when malformed code is sent to the database server, thus leading to the exposure of your data. And this attack style is so simple and easy, anyone with access to the internet can do it – SQLi scripts are available for download and can be acquired easily. As one of the most common vulnerabilities, we seem to know a lot about it and yet, new SQLi attacks are always popping up – just take a quick look at the&nbsp;<a href="http://codecurmudgeon.com/wp/sql-injection-hall-of-shame/">SQLi Hall-of-Shame</a>&nbsp;and see for yourself.</p>
<h1>Example</h1>
<p>Using a simple page, which displays an article with given ID as the parameter, the attacker may perform a couple of simple tests to determine if the page is vulnerable to SQL Injection attacks.</p>
<p>Example URL:</p>
<figure class="table">
  <table>
    <tbody>
      <tr>
        <td><code>http://</code><a href="http://newspaper.com/items.php?id=2"><code>newspaper.com/items.php?id=2</code></a></td>
      </tr>
    </tbody>
  </table>
</figure>
<p>The above sends the following query to the database:</p>
<figure class="table">
  <table>
    <tbody>
      <tr>
        <td><code>SELECT title, description, body FROM items WHERE ID = 2</code></td>
      </tr>
    </tbody>
  </table>
</figure>
<p>The attacker may then try to inject a query that returns 'false':</p>
<figure class="table">
  <table>
    <tbody>
      <tr>
        <td><code>http://</code><a href="http://newspaper.com/items.php?id=2"><code>newspaper.com/items.php?id=2</code></a><code> and 1=2</code></td>
      </tr>
    </tbody>
  </table>
</figure>
<p>If the application is vulnerable to the attack, (a) it won't notice that it received a string rather than an id, (b) it might create the SQL query by simply substituting the string. The SQL query could end up looking like this:</p>
<figure class="table">
  <table>
    <tbody>
      <tr>
        <td><code>SELECT title, description, body FROM items WHERE ID = 2 and 1=2</code></td>
      </tr>
    </tbody>
  </table>
</figure>
<p>If the web application is vulnerable to SQL Injection, then it probably will not return anything. To make sure, the attacker will inject a query that will return 'true':</p>
<figure class="table">
  <table>
    <tbody>
      <tr>
        <td><code>http://</code><a href="http://newspaper.com/items.php?id=2"><code>newspaper.com/items.php?id=2</code></a><code> and 1=1</code></td>
      </tr>
    </tbody>
  </table>
</figure>
<p>If the content of the page that returns 'true' is different than that of the page that returns 'false', then the attacker is able to distinguish when the executed query returns true or false.</p>
<p>Once this has been verified, the only limitations are privileges set up by the database administrator, different SQL syntax, and the attacker's imagination.</p>
<h1>How BBWT3 Mitigates This Vulnerability</h1>
<p>BBWT3 does not use SQL directly, but uses LINQ (Language-Integrated Query) for input. By doing this it makes it much harder for an attacker. This is because it is harder to parse some of the input string as a parameter, and parse another part of it as executable code. LINQ uses named parameters which are prepared statements, a mapping is kept between the parameter names and their indices - the brackets containing values. This mapping is referred to when the parameters are injected, clearly stating the name of each parameter within the function call. Meaning that the web application won't execute any SQL code that it isn't expecting, thus removing the ability of an attacker to inject and run arbitrary code.</p>
<figure class="table">
  <table>
    <tbody>
      <tr>
        <td><code>-- Example of LINQ-generated SQL code, below.</code><br><code>-- This is a parameterised query.</code><br><code>SELECT</code>&nbsp;<code>[t0].[title], [t0].[description], [t0].[body]&nbsp;FROM</code>&nbsp;<code>[dbo].[items]&nbsp;AS</code>&nbsp;<code>[t0]</code><br><code>WHERE</code>&nbsp;<code>[t0].[id] = @p0</code><br>&nbsp;<br>&nbsp;<br><code>-- Parameterized queries treat input as a literal value when executed as part of the SQL statement</code><br><code>-- So, under attack, this effectively becomes the query below, making it impossible for the server to confuse input parameter with code.</code><br>&nbsp;<br>&nbsp;<br><code>SELECT</code>&nbsp;<code>[t0].[title], [t0].[description], [t0].[body]&nbsp;FROM</code>&nbsp;<code>[dbo].[items]&nbsp;AS</code>&nbsp;<code>[t0]</code><br><code>WHERE</code>&nbsp;<code>[t0].[id] =&nbsp;'2 and 1=2'</code><br>&nbsp;<br>&nbsp;<br><code>-- Definitely not the below:</code><br>&nbsp;<br>&nbsp;<br><code>SELECT</code>&nbsp;<code>[t0].[title], [t0].[description], [t0].[body]&nbsp;FROM</code>&nbsp;<code>[dbo].[items]&nbsp;AS</code>&nbsp;<code>[t0]</code><br><code>WHERE</code>&nbsp;<code>[t0].[id] = 2&nbsp;and</code>&nbsp;<code>1=2</code></td>
      </tr>
    </tbody>
  </table>
</figure>
<p>Be wary where developers are using the method "FromSQL" - this means they've handcrafted the SQL string rather than relied on LINQ to craft it for them.</p>
<h1>Other Resources</h1>
<p>OWASP 2017 full details -&nbsp; page 7 of&nbsp;<a href="https://www.owasp.org/images/7/72/OWASP_Top_10-2017_%28en%29.pdf.pdf">https://www.owasp.org/images/7/72/OWASP_Top_10-2017_%28en%29.pdf.pdf</a>&nbsp;</p>
<p>Document generated by Confluence on Nov 27, 2020 10:56</p>
<p><a href="http://www.atlassian.com/">Atlassian</a></p>
