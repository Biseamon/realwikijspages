<!--
title: A4:2017 - XML External Entities (XXE)
description: 
published: true
date: 2020-12-02T14:54:57.336Z
tags: 
editor: ckeditor
dateCreated: 2020-11-27T11:01:14.719Z
-->

<h1>Blueberry Group : A4:2017 - XML External Entities (XXE)&nbsp;</h1>
<p>Created by Jason Cozza on Sep 22, 2020</p>
<h1>Overview<br>&nbsp;</h1>
<p>An&nbsp;<a href="https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Processing">XML External Entity attack</a>&nbsp;is a type of attack against an application that parses XML (eXtensible Markup Language) input. This attack occurs when XML input containing a reference to an external entity is processed by a weakly configured XML parser. This attack may lead to the disclosure of confidential data, denial of service, server side request forgery, port scanning from the perspective of the machine where the parser is located, and other system impacts.</p>
<h1>Example<br>&nbsp;</h1>
<p>Remote code execution could be achieved by an attacker creating their own XML file, which may disclose target files such as web application secrets (e.g. database passwords)</p>
<figure class="table">
  <table>
    <tbody>
      <tr>
        <td><code>&lt;?xml version="1.0"</code>&nbsp;<code>encoding="ISO-8859-1"?&gt;</code><br><code>&lt;!DOCTYPE foo [&nbsp;</code><br><code>&nbsp; &lt;!ELEMENT foo ANY &gt;</code><br><code>&nbsp; &lt;!ENTITY xxe SYSTEM&nbsp;"</code><a href="file:///etc/passwd"><code>file:///etc/passwd</code></a><code>"</code>&nbsp;<code>&gt;]&gt;&lt;foo&gt;&amp;xxe;&lt;/foo&gt;</code></td>
      </tr>
    </tbody>
  </table>
</figure>
<h1>How BBWT3 Mitigates This Vulnerability</h1>
<p>Uses where possible JSON files instead of more complex data formats.</p>
<ul>
  <li>External entities references are disabled where XML&nbsp;<strong>is</strong>&nbsp;used<br><br>&nbsp;</li>
</ul>
<p>As per OWASP guidelines, BBWT3 attempts to use JSON files where possible instead of XML ones.</p>
<p>Use of XML is potentially dangerous as an attacker could use an XML file to freely explore the files on the webserver.</p>
<p>The only time that BBWT3 does accept XML files is for SAML authentication - which allows for a user to login with an existing account instead of creating a new one for the web app. In this code, the XmlResolver is set to null - this completely prevents access to external entities.</p>
<p>Note well: if accepting other XML formats in the future, attention must be given to disabling the XmlResolver there, also.</p>
<h1>Other Resources</h1>
<p>OWASP 2017 full details -&nbsp; page 9 of&nbsp;<a href="https://www.owasp.org/images/7/72/OWASP_Top_10-2017_%28en%29.pdf.pdf">https://www.owasp.org/images/7/72/OWASP_Top_10-2017_%28en%29.pdf.pdf</a></p>
<p>Document generated by Confluence on Nov 27, 2020 10:56</p>
<p><a href="http://www.atlassian.com/">Atlassian</a></p>
