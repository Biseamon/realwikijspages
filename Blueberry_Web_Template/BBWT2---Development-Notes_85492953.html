<!--
title: BBWT2---Development-Notes_85492953
description: 
published: true
date: 2020-12-02T11:53:56.360Z
tags: 
editor: undefined
dateCreated: 2020-11-27T11:01:45.848Z
-->

<!DOCTYPE html>
<html>
    <head>
        <title>Blueberry Group : BBWT2 - Development Notes</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Blueberry Group</a></span>
                            </li>
                                                    <li>
                                <span><a href="Blueberry-Web-Template_85492520.html">Blueberry Web Template</a></span>
                            </li>
                                                    <li>
                                <span><a href="BBWT2_85492528.html">BBWT2</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Blueberry Group : BBWT2 - Development Notes
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Jason Cozza</span> on Sep 21, 2020
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p>The purpose of this document is to describe specific features and code samples to illustrate how the new BBWT technology stack should be used to make each part compatible with others.<br/><br/>Each layer will be described from database storage through to User UI.<br/><br/>The BBWT2 test site can be found here: <a class="external-link" href="http://bbwt2-test.demo.bbconsult.co.uk/" rel="nofollow">http://bbwt2-test.demo.bbconsult.co.uk/</a><br/><br/>The BBWT2 customer-facing demo site can be found here: <a class="external-link" href="http://bbwt2.demo.bbconsult.co.uk/" rel="nofollow">http://bbwt2.demo.bbconsult.co.uk/</a></p><h2 id="BBWT2-DevelopmentNotes-ApplicationArchitecture">Application Architecture</h2><hr/><p>The BBWT application uses layered architecture. To reduce dependencies, each layer can only call one level below in the hierarchy.  Every public class is inherited from interface to make it possible to use unit tests and simplify the creation of test methods.<br/><br/>We also have a few classes, such as the logging class, which can be used from any layer.<br/><br/>The following technologies are used in this project:</p><ul><li>WebAPI/OData controllers on top of ASP.NET MVC - standartized way of API creation</li></ul><ul><li>Unity DI container - dependency injection container class</li></ul><ul><li>Entity Framework - ORM used to access data</li></ul><ul><li>AngularJS - powerful framework which adds MVC to JS code and improves HTML by new directives</li></ul><ul><li>Typescript - Language which compiles to JS code</li></ul><ul><li>Kendo WEB UI - rich set of web ui elements</li></ul><ul><li>MSSQL Server - database server to store data</li></ul><h2 id="BBWT2-DevelopmentNotes-IDESettings">IDE Settings</h2><hr/><p><a class="external-link" href="http://vswebessentials.com/features/html" rel="nofollow">Web Essentials</a>, <a class="external-link" href="https://github.com/matijagrcic/AngularJS-Intellisense-For-Visual-Studio" rel="nofollow">Angular JS Intellisence</a> and <a class="external-link" href="http://www.jetbrains.com/resharper/" rel="nofollow">Resharper</a> (I’m sure it is possible to have just two options above to get Angular code support)</p><p>Note: R# since v8.2 has extension AngularJS with Intellisence support</p><p>Typescript part has “definition” files which can be used to get VS intellisense working in TS code. It is specific type of code file which describes class structure and function parameters with their types. Definition files can be found for every popular library like jquery and allow to use JS libraries as if they are native TS libraries.<br/><br/>Here is a good source for many definitions: <a class="external-link" href="https://github.com/borisyankov/DefinitelyTyped" rel="nofollow">https://github.com/borisyankov/DefinitelyTyped</a><br/><br/>Some information (not too much) can be found here: <a class="external-link" href="http://sravi-kiran.blogspot.com/2012/10/CreatingTypeScriptTypeDeclarationFileForAnExistingJQueryPlugin.html" rel="nofollow">http://sravi-kiran.blogspot.com/2012/10/CreatingTypeScriptTypeDeclarationFileForAnExistingJQueryPlugin.html</a><br/><br/>Chrome browser has AngularJS debugger extension (Batarang)<a class="external-link" href="https://chrome.google.com/webstore/detail/angularjs-batarang/ighdmehidhipcmcojjgiloacoafjmpfkI" rel="nofollow">https://chrome.google.com/webstore/detail/angularjs-batarang/</a> - it works but is not particularly useful.</p><h2 id="BBWT2-DevelopmentNotes-AFewWordsAboutDependencyInjection">A Few Words About Dependency Injection</h2><hr/><p>One of the interesting things included in MVC is the out of the box Dependency Injection container support. Previously, the DI template invention application component used global singletons, service locators or created dependent objects itself to get the class instance. DI changes the way such “system” objects are accessed. This application uses Unity DI container.<br/><br/>If a DI container is used - the application classes are not created as dependent objects directly. Instead, classes use an external component (DI container) to resolve dependencies and create object instances. The container also manages the object’s lifetime strategy, which can turn a normal object into a singleton or use one object per thread or one per http request.<br/><br/>Dependency resolution is centralised and much more flexible than the old-style dependencies support.<br/><br/>There are many popular DI containers, such as Unity, Ninject, etc, but it is hard to say which one is best. As far as I can tell, and my opinion is based on many forums and review articles, all of them have similar functionality, reliability and performance. I chose Unity because it is created by P&amp;P, who prepare many best practice recommendations in collaboration with Microsoft and based on MS stack.<br/><br/>There are two possible ways to use DI in an <a class="external-link" href="http://asp.net" rel="nofollow">asp.net</a> application. The first one is “Service locator” based on DI container. In this case, the class calls the container methods directly using DI methods to get the dependency class instance. This way is <strong>STRONGLY NOT RECOMMENDED</strong> because unit test support will be relatively hard. DI container is one more dependency we need to keep in mind, especially during unit test creation.<br/><br/>Another way of DI is using constructor-based DI resolution. In this case, object instances are always created indirectly by DI.<br/><br/>For example, if you need to create a typical MVC controller class, you need to use a signature like this:</p><blockquote><em>   public class AuthController : ApiController</em><br/><em>   {</em><br/><em>       private IMembershipService membershipService;</em><br/><em>       public AuthController(IMembershipService membershipService)</em><br/><em>       {</em><br/><em>           this.membershipService = membershipService;</em><br/><em>           …</em><br/><em>       }</em><br/><em>   }</em></blockquote><p><br/>“membershipService” instance will automatically be created and passed into the controller at the AuthController instantiation stage. MembershipService also may use dependency injection parameters in its constructor if needed.<br/><br/>As you can see, the constructor uses interface instead of class type - this is one of the important elements that allows the use of DI and the creation of unit tests.<br/><br/>To configure the DI container and to define object creation application, you can use the configuration section in web.config and/or configuration code in the application startup file.<br/><br/>Here is part of the <strong>bootstraper.cs</strong> file:</p><blockquote><em>…</em><br/><em>       public static IUnityContainer Initialise()</em><br/><em>       {</em><br/><em>           var container = new UnityContainer();</em><br/><em>           container.RegisterType&lt;IPrincipal&gt;(new InjectionFactory(c =&gt; HttpContext.Current.User));</em><br/><br/><em>           container.LoadConfiguration();</em><br/><br/><em>           DependencyResolver.SetResolver(new UnityDependencyResolver(container));</em><br/><em>           GlobalConfiguration.Configuration.DependencyResolver = new Unity.WebApi.UnityDependencyResolver(container);</em><br/><em>           </em><br/><em>           return container;</em><br/><em>       }</em><br/><em>…</em></blockquote><p>The first few lines add configuration to solve IPrincipal dependency resolution. RegisterType method parameter is “InjectionFactory”, which allows the use of custom dependency resolution code. In our case, IPrincipal will be resolved using the current HTTP user instance. Therefore, anywhere that the class constructor uses the IPrincipal parameter, it will be resolved using the current HTTP user instance - we do not need to get it directly from the HTTP context.<br/><br/>Here is an example of the configuration included in the web.config:</p><blockquote> <em>  &lt;unity xmlns=&quot;<a class="external-link" href="http://schemas.microsoft.com/practices/2010/unity" rel="nofollow">http://schemas.microsoft.com/practices/2010/unity</a>&quot;&gt;</em><br/><em>       &lt;container&gt;</em><br/><em>           &lt;register type=&quot;BBWT.Services.IMembershipService, BBWT.Services&quot; mapTo=&quot;BBWT.Services.MembershipService, BBWT.Services&quot; /&gt;</em><br/><em>           &lt;register type=&quot;BBWT.Domain.IDataContext, BBWT.Domain&quot; mapTo=&quot;BBWT.Domain.DataContext, BBWT.Domain&quot;&gt;</em><br/><em>               &lt;lifetime type=&quot;BBWT.Web.HttpRequestLifetimeManager, BBWT.Web&quot; /&gt;</em><br/><em>           &lt;/register&gt;</em><br/><em>...   </em><br/><em>       &lt;/container&gt;        </em><br/><em>   &lt;/unity&gt;</em></blockquote><p><br/>IMembership interface will be resolved using the “MembershipService” class from BBWT. Services assembly. Constructor-based injection from the example above uses this definition. IDataContext uses the “DataContext” class instance from BBWT. Domain assembly and custom lifetime strategy “Instance per HTTP request”. Default lifetime strategy is “instance per DI call”</p><h2 id="BBWT2-DevelopmentNotes-DBAccessLayer">DB Access Layer</h2><hr/><p><strong>EF Code-First</strong><br/><br/>BBWT2 uses Entity Framework “Code First” as the base of the database access layer. It is a really powerful tool to create DAL with minimal effort. The first thing to do to add a new entity into the database is data object creation. All data objects should be created in BBWT Data project. Nothing related to the physical database should be here - we just need to create plain objects that are part of the domain model.<br/><br/>Here is an example of a data class:</p><blockquote> <em>public class User : Entity</em><br/><br/><em>   {</em><br/><em>       public string Name { get; set; }</em><br/><em>       public string EMail { get; set; }</em><br/><em>       public bool IsAdmin { get; set; }</em><br/><em>       public virtual ICollection&lt;Permission&gt; Permissions { get; set; }</em><br/><em>       public virtual ICollection&lt;Role&gt; Roles { get; set; }</em><br/><em>       public virtual ICollection&lt;Group&gt; Groups { get; set; }</em><br/><em>   }</em></blockquote><p><br/>One important note: if you need to turn on lazy loading feature for class property, you need to make this property virtual. In the example above, Roles and Groups will use lazy loading. To be able to lazy load, the property class instance should be connected to the database at the time we try to get the property value.<br/><br/>All database-related classes are placed in the BBWT.Domain project. Three pieces of code are important here:<br/><br/>Mapping classes are used to define the mapping between the data model and the database fields. If there is a case where the  field is not defined in mapping default, mapping rules will be used.<br/><br/>An example of a mapping class:</p><blockquote><em>   public class MenuItemMap : EntityTypeConfiguration&lt;MenuItem&gt;</em><br/><em>   {</em><br/><em>       public MenuItemMap()</em><br/><em>       {</em><br/><em>           this.HasKey(t =&gt; t.Id);</em><br/><br/><em>           this.Property(t =&gt; t.Id)</em><br/><em>               .HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity)</em><br/><em>               .HasColumnName(&quot;Id&quot;);</em><br/><br/><em>           this.Property(t =&gt; t.Name).HasColumnName(&quot;Name&quot;).IsRequired();</em><br/><em>           this.Property(t =&gt; t.Url).HasColumnName(&quot;URL&quot;).IsOptional();</em><br/><em>           this.Property(t =&gt; t.Order).HasColumnName(&quot;Order&quot;).IsRequired();</em><br/><br/><em>           this.HasOptional(t =&gt; t.Parent)</em><br/><em>               .WithMany(t =&gt; t.Children)</em><br/><em>               .Map(t =&gt; t.MapKey(&quot;ParentId&quot;))</em><br/><em>               .WillCascadeOnDelete(false);</em><br/><em>           this.ToTable(&quot;MenuItems&quot;);</em><br/><em>       }</em><br/><em>}</em></blockquote><p><br/>All lines of code in the example above should be self-explanatory.<br/><br/>Another part of code to pay attention to is the migrations support. Currently the project has no overly complicated class structures so we can use automatic migrations - the database automatically updates its structure to match the classes and mapping rules. However, this means that when the database contains many tables and lots of data rows, we would need to use manual migrations to properly update the data. (See manual migrations topics in EF documentation).</p><p>We can lose useful development time when we use manual migrations - because they are time consuming to write. But we can also lose useful development time when we use automatic migrations – because there are merge issues when multiple people are committing schema changes. Please read <a class="external-link" href="https://msdn.microsoft.com/en-us/data/dn481501.aspx" rel="nofollow">https://msdn.microsoft.com/en-us/data/dn481501.aspx</a> . It details the merge problems and how to quickly work around them. <br/><br/>In short - console command can be used to create a migration class which has UP and DOWN methods. The first one updates the database structure and the second one downgrades it. Every migration has a version number. Database uses special system table to track applied migrations.<br/><br/>Having such a structure means that it is very flexible because we would get one-month-old sources from SVN and the database will be automatically migrated to that old state. Database migration code is stored as part of the SVN revision and keeps the database always up-to-date without addition efforts.</p><h4 id="BBWT2-DevelopmentNotes-DataContext">Data Context</h4><p>One more important part of the data access layer is data context. It is a special purpose class, which has a set of collections for every entry point.</p><blockquote> <em>   public class DataContext : DbContext, IDataContext</em><br/><em>   {</em><br/><em>        public IDbSet&lt;User&gt; Users { get; set; }</em><br/><em>       public IDbSet&lt;Role&gt; Roles { get; set; }</em><br/><em>       public IDbSet&lt;Group&gt; Groups { get; set; }</em><br/>…</blockquote><p> </p><h4 id="BBWT2-DevelopmentNotes-InitialDataCreation">Initial Data Creation</h4><p>To create initial data, such as default admin and demo users creation, permissions and roles creation and dictionary entries creation together with database structure update.<br/><br/>Here is an example of such code:</p><blockquote> <strong>~\BBWT.Domain\Migrations\Configuration.cs</strong><br/><em>       private void SeedProducts(DataContext context)</em><br/><em>       {</em><br/><em>           context.TestProducts.AddOrUpdate(new TestProduct { Id = 1, Name = &quot;Orange&quot;, Price = 100 });</em><br/><em>           context.TestProducts.AddOrUpdate(new TestProduct { Id = 2, Name = &quot;Apple&quot;, Price = 200 });</em><br/><em>           context.TestProducts.AddOrUpdate(new TestProduct { Id = 3, Name = &quot;Banana&quot;, Price = 123 });</em><br/><em>           context.Commit();</em><br/><em>       }</em></blockquote><h2 id="BBWT2-DevelopmentNotes-Permissionssupport"> Permissions support</h2><hr/><p>The application has a defined set of permissions - some of them are system, others are custom. System permissions have IDs in the range between 1 - 1000. Programmers can safely create system permissions in the context configuration code using the ID from this range. The custom permissions IDs starts from 1001 and increase from there.<br/><br/>The permissions hierarchy is inherited from the old BBWT code. This means permissions can be applied to a user directly or added to a user role or user group. If a user has a role assigned or belongs to a group, all permissions lists will be concatenated to get a single list of “effective permissions”.</p><h2 id="BBWT2-DevelopmentNotes-ServiceLayer">Service Layer</h2><hr/><p>This layer is used to do all of the business area activities. Each method should be carefully reviewed to make sure that it has not got any security problems. It should check if the user has enough permissions to run the method, results should be filtered according permissions, etc.</p><h2 id="BBWT2-DevelopmentNotes-InterfaceLayer">Interface Layer</h2><hr/><p>To access server-side data we use an API which serves methods over HTTP protocol.</p><h4 id="BBWT2-DevelopmentNotes-OData"> OData</h4><p><br/>OData is a protocol that defines communication way between client and server. It also has a set of commands that can be sent from the client to apply additional processing to a method result.<br/><br/>Some examples of OData commands are: $top, $skip, $order, $filter, $inlinecount.<br/><br/>The best thing we have - all of these methods are supported automatically when we inherit our MVC controller from the ODataController class. Hoever, there is one important requirement - controller should return IQueryable. Unfortunately, OData controller configuration does need more effort to configure and some methods are not easy to configure.<br/><br/>Here is an example of an OData controller method:</p><blockquote> <em>       public IQueryable&lt;GroupDTO&gt; Get()</em><br/><em>       {</em><br/><em>           return this.membershipService.GetAllGroups().Project().To&lt;GroupDTO&gt;();</em><br/><em>       }</em></blockquote><p><br/>Example of OData method configuration:</p><blockquote><em>           var modelBuilder = new ODataConventionModelBuilder();</em><br/><em>           modelBuilder.EntitySet&lt;PermissionDTO&gt;(&quot;PermissionsOData&quot;);</em><br/><em>           modelBuilder.EntitySet&lt;GroupDTO&gt;(&quot;GroupsOData&quot;);</em><br/><em>           modelBuilder.EntitySet&lt;RoleDTO&gt;(&quot;RolesOData&quot;);</em><br/><em>           modelBuilder.EntitySet&lt;UserDTO&gt;(&quot;UsersOData&quot;);</em><br/><br/><em>           IEdmModel model = modelBuilder.GetEdmModel();</em><br/><em>           config.Routes.MapODataRoute(routeName: &quot;OData&quot;, routePrefix: &quot;odata&quot;, model: model);</em></blockquote><p> </p><h4 id="BBWT2-DevelopmentNotes-WebAPI">Web API</h4><p>To reduce the amount of code required to configure API methods, we use Web API to create many business methods. Web API also supports OData commands but only a few of them are supported. One of the important commands that is not supported is $inlinecount. This is the main reason that both ODataController and ApiController are used at the same time.</p><h4 id="BBWT2-DevelopmentNotes-DataTransferObjects">Data Transfer Objects</h4><p>As you can see, it just calls service methods and does not do any other business activities.<br/><br/>Instead, these methods use another important piece of code. They isolate the domain object and the data context from the client. To transfer data methods, use “data transfer objects” which are “projections” of normal data objects that have a restricted set of fields (only the ones needed for this particular call).<br/><br/>To simplify copying data from domain to data transfer objects, the  application uses the “Auto Mapper” library. Before code calls mapping method AutoMapper should be configured. A good place to configure mapping is in a class constructor.<br/><br/>An example of mapping configuration that allows data to be copied into GroupDTO:</p><blockquote><em>Mapper.CreateMap&lt;Group, GroupDTO&gt;();</em></blockquote><h2 id="BBWT2-DevelopmentNotes-AngularJS">AngularJS</h2><hr/><p>AngularJS is a fantastic JS tool. When I saw Angular code for the first time, it looked like magic.<br/><br/>It uses “html extensions” and declarative programming instead of a traditional imperative one.<br/><br/>MVC is a popular design template nowadays and it is used as the main template in these type of applications.<br/><br/>Angular is not the only tool which uses this paradigm. Knockout is another similar engine and backbone is another. In contrast to these tools, Angular has more development areas covered and doesn’t need any additional library (very rarely in comparison with KnockoutJS)<br/><br/>Angular has “port” to Kendo Web UI (see below) to make markup simplier.<br/><br/>Below is a piece of code with angular markup:</p><blockquote> <em>&lt;div permission=&quot;ManageGroups&quot;&gt;</em><br/><em>   &lt;label&gt;Group Name:&lt;/label&gt;</em><br/><em>   &lt;input type=&quot;text&quot; ng-model=&quot;Group.Name&quot; required/&gt; &lt;br/&gt;   </em><br/><em>   &lt;button ng-click=&quot;Save(Group)&quot;&gt;Save&lt;/button&gt;</em><br/><em>   &lt;button ng-click=&quot;Cancel()&quot;&gt;Cancel&lt;/button&gt;</em><br/><em>&lt;/div&gt;</em></blockquote><p><br/>As you can see here, the form logic is packed into the controller. The data field is bound with object property and HTML elements have angular directives to add some functionality.</p><h2 id="BBWT2-DevelopmentNotes-KendoWebUI">Kendo Web UI</h2><hr/><p>Kendo web ui is a set of components which can be used to create a user interface fast and reliably. It has more than just visual components - there are also a few really interesting features like data sources and styles. In addition, Kendo provides an engine that is very similar to Knockout and can potentially replace angular in a case where we don’t need to create a very specific application.<br/><br/>See <a href="https://wiki.bbconsult.co.uk/display/BLUEB/Kendo+UI+Details" rel="nofollow">Kendo UI details</a> page for more information.</p><h2 id="BBWT2-DevelopmentNotes-Typescript"> Typescript</h2><hr/><p>Typescript is a “better javascript”. The most useful features I found in TS are code completion support and variables typization. Of Course there are some restrictions as well. I will describe these below:<br/><br/></p><ul><li> Even if JS is always valid TS code, the code structure is different.</li></ul><p> </p><ul><li>Angular has several types of modules - each has specific features when we use TS to write angular code.</li></ul><h4 id="BBWT2-DevelopmentNotes-Controllers">Controllers</h4><p><br/>Typical controller looks like this:</p><blockquote> <em>module Controllers {<br/></em>   <em>export class IHomeScope {</em><br/><em>ShowAlert: () =&gt; void;</em><br/>}<br/><em>   export class HomeCtrl {</em><br/><em>       ShowAlert: () =&gt; void;</em><br/><em>       MyData: any = {};</em><br/><br/><em>       static $inject: Array&lt;string&gt; = ['$scope'];</em><br/><em>       constructor($scope: ng.IHomeScope) {</em><br/><em>            $scope.ShowAlert = () =&gt; alert('it works!');</em><br/><em>           MyData.MyField = ‘test me’;</em><br/><em>       }</em><br/><em>   }</em><br/><em>}</em></blockquote><p><br/>As you can see, it defines “controllers” module, exports one method and has a constructor to setup the class instance. This small example shows a few ideas you need to use in your code.<br/><br/><strong>Important notes to this example:</strong></p><ul><li>Make sure you have $inject array defined and the names and number of array elements match the constructor parameters list. If you have any differences, your code will be broken by minifier in release mode!</li><li>Make sure you have $inject array defined and the names and number of array elements match the constructor parameters list. If you have any differences, your code will be broken by minifier in release mode!</li><li>It is possible to define methods “directly” but they are assigned in the constructor instead because you don’t need to keep services in variables - closures are used instead.</li><li>$scope variable assignments may use object-style definition or array-style definition. object style doesn’t work in case if strongly-typed parameter is used.</li><li>Object instance is stored in $scope - nothing else should be stored there, even if angular documentation says that everything should be stored in scope. If we don’t use such an assignment, we are not able to find objects hidden inside the namespace.</li><li>MyData is part of class, not member of $scope. It is because the context object may be lost when it is used in more than one input field.</li><li>Functions use lambda-style definitions, which makes code lighter and allows the use of strongly typed function definitions.</li></ul><h4 id="BBWT2-DevelopmentNotes-Directives">Directives</h4><p>The most important issue solved by the piece of code below is directive registration keeping directive code in separate file and using TS:</p><blockquote> <em>module Directives {</em><br/><em>   export class Login {</em><br/><em>       static $inject = ['PermissionsSvc'];</em><br/><em>       constructor(PermissionsSvc: Services.PermissionsSvc) {</em><br/><em>           var directive: ng.IDirective =</em><br/><em>               {</em><br/><em>                   restrict: &quot;E&quot;,</em><br/><em>                   transclude: true,</em><br/><em>                   templateUrl: &quot;app/directives/login_control.html&quot;,</em><br/><em>                   controller: &quot;LoginCtrl&quot;</em><br/><em>               }</em><br/><em>           return directive;</em><br/><em>       }</em><br/><em>   }</em><br/><em>}</em><br/><em>angular.module('Directives', []).directive('login', ['PermissionsSvc', (PermissionsSvc) =&gt; {</em><br/><em>   return new Directives.Login();</em><br/><em>}]);</em></blockquote><p><br/><strong>Important lines of code:</strong></p><ul><li>You can see how the $inject variable is defined (the constructor following directly below $inject variable definition).</li><li>Directive initialization at the bottom of the code sample has an array as a second parameter and is required to do the correct injection in case of code minification.</li></ul><h2 id="BBWT2-DevelopmentNotes-NUnitTests">NUnit Tests</h2><hr/><p>To test applications we use NUnit test engine. Another possible choice was the testing engine provided by MS but unfortunately it is only available in expensive versions of Visual Studio. NUnit is free and has the same set of features.<br/><br/>As we created application layers using dependency injection pattern, it is easy to create artificial environments for every class we want to test. It allows us to run tests quickly and create all required test data as an array of objects in memory, where each object is created specifically for the test. No database connections are needed.</p><h2 id="BBWT2-DevelopmentNotes-Logging">Logging</h2><hr/><p>We decided to create a logging system that allows us to send logs from both the client and server sides to the same destination. There are few components in chain. Logging backend is based on NLog library which has rich variety of possible log entry destinations. It is possible to use NLog directly on the server side but we have one more abstraction between logging code and backend. It was introduced into the code as a dependency of the client side logging library named JSNLog. It uses one simple line of server side code, which appends everything needed to page output. As result we have set of JS functions on the client side which can be used to send logs to the browser console and/or to the server side. If we have a specific configuration on the server side, our client and server log entries will use the same target to write logs. As a result, all log messages are part of the same log file.<br/><br/>One more interesting feature is support for remote NLog protocol. For example, we would start a tool named Sentinel on the server side and start to receive log messages (<a class="external-link" href="http://sentinel.codeplex.com/" rel="nofollow">http://sentinel.codeplex.com/</a>). Of course, it is possible to use any log entries destination, even simultaneously.<br/><br/>Using additional abstraction allows us to use interfaces instead of classes and inject dependencies using Unity (if we want to do this).<br/><br/>Here are few samples of logging code:<br/><br/>The client-side code looks like this:</p><blockquote> <em>JL().warn('Unauthorized access to page: ' + $location.url);</em></blockquote><p><br/>server side code has more code lines</p><blockquote><em>using Common.Logging;</em><br/><br/><em>…</em><br/><br/><em>public class &lt;Class name&gt;{</em><br/><br/><em>private static ILog Logger = LogManager.GetCurrentClassLogger();</em><br/><br/><em>…</em><br/><br/><em>Logger.Error(Server.GetLastError());</em></blockquote><h2 id="BBWT2-DevelopmentNotes-CSSandJavaScriptCompression">CSS and JavaScript Compression</h2><hr/><p>MVC4 has “bundles” support built-in. It helps to reduce the number of JS/CSS files to download to the client and the amount of data to transfer. All scripts and styles can be automatically joined and minified before sending them to the server. A debug version of the site always sends all files separately and turns caching off.<br/><br/>To configure “bundles” you need to add scripts/styles in ~/app_start/BundleConfig.cs file.<br/><br/>Each bundle appears as a separate resource on the page and joins bundle files in one big file.<br/><br/>It is possible to use wildcards to choose files to be included into a bundle - this is a really useful feature because you don’t need to set JS link somewhere directly, you just put all scripts in the same folder on the server.<br/><br/>Here is an example of bundle configuration:</p><blockquote> <em>bundles.Add(new ScriptBundle(&quot;~/bundles/jquery&quot;).Include(</em><br/><br/><em>           &quot;~/Scripts/jquery-{version}.js&quot;,</em><br/><br/><em>           &quot;~/Scripts/underscore.js&quot;));</em></blockquote><p><br/>It is possible to configure a bundle to use scripts placed in CDN.<br/><br/>Details about bundles and minification support can be found here: <a class="external-link" href="http://www.asp.net/mvc/tutorials/mvc-4/bundling-and-minification" rel="nofollow">http://www.asp.net/mvc/tutorials/mvc-4/bundling-and-minification</a></p><h2 id="BBWT2-DevelopmentNotes-Jenkins">Jenkins</h2><hr/><p>To be able to build a project from the command line on Jenkins slave servers some components should be installed there. Typescript, Nuget, NUnit, .NET4.5 are the minimum that need to be installed. In addition, if Visual Studio is not installed on the server, some build targets files should be copied over from the development machine to be able to build Typescript files and Nuget tests. All of these steps are done already but if we would want to configure another server at a later time, the same updates need to be applied.</p><h2 id="BBWT2-DevelopmentNotes-MSSQLServer">MS SQL Server</h2><hr/><p>To store data we use MSSQL Express 2008 or higher.</p><p>SQL Server Compact isn’t something we expect to ever need working with BBWT2. Compact Edition is only intended for use on desktops and mobile devices. Express Edition is the “lowest” Edition that we expect to support.</p><p>A recent experiment indicates that we would have significant issues attempting to run BBWT2 on Compact Edition.</p><p> </p><h2 id="BBWT2-DevelopmentNotes-MSSQLServerReportingServices">MS SQL Server Reporting Services</h2><hr/><p>If you want to create reports by using SSRS then take a look to the following page <a href="https://wiki.bbconsult.co.uk/display/BLUEB/Reporting+Details" rel="nofollow">Reporting Details</a> to get report templates including useful URL that will allow you to understand how they were created.</p><h2 id="BBWT2-DevelopmentNotes-Appendix.Usefulresources">Appendix. Useful resources</h2><hr/><p>The most useful source of information was youtube channels about angular and typescript (I’m surprised by this fact)<br/><br/>Say, this set of TS videos may be useful:<br/><br/><a class="external-link" href="http://www.youtube.com/channel/UCuJb1-v0NJIQCZzA8r2aF6g/search?query=typescript" rel="nofollow">http://www.youtube.com/channel/UCuJb1-v0NJIQCZzA8r2aF6g/search?query=typescript</a><br/><br/>Some information about Typescript:<br/><br/><a class="external-link" href="http://www.typescriptlang.org/" rel="nofollow">http://www.typescriptlang.org/</a><br/><br/><a class="external-link" href="http://www.codeproject.com/Articles/470129/TypeScript-Superset-of-JavaScript" rel="nofollow">http://www.codeproject.com/Articles/470129/TypeScript-Superset-of-JavaScript</a><br/><br/><a class="external-link" href="http://www.typescriptlang.org/Playground/" rel="nofollow">http://www.typescriptlang.org/Playground/</a><br/><br/>These links may be even more useful: Angular+TypeScript<br/><br/><a class="external-link" href="http://notebookheavy.com/2013/05/22/angularjs-and-typescript/" rel="nofollow">http://notebookheavy.com/2013/05/22/angularjs-and-typescript/</a><br/><br/><a class="external-link" href="http://www.youtube.com/user/basaratali?feature=watch" rel="nofollow">http://www.youtube.com/user/basaratali?feature=watch</a><br/><br/>Here I described some standard templates of TS code which work perfectly with Angular.<br/><br/><a class="external-link" href="https://docs.google.com/a/bbconsult.co.uk/document/d/1wFkeSnINT0XfL8CXvMm5nJQUb70gwDr4FX3wJ4ZjVYc/edit" rel="nofollow">https://docs.google.com/a/bbconsult.co.uk/document/d/1wFkeSnINT0XfL8CXvMm5nJQUb70gwDr4FX3wJ4ZjVYc/edit#</a></p>
                    </div>

                    
                 
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Nov 27, 2020 10:56</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
