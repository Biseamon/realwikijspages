<!--
title: GitLab-and-DevOps_37062847
description: 
published: true
date: 2020-12-03T14:58:11.106Z
tags: 
editor: undefined
dateCreated: 2020-12-03T14:58:08.994Z
-->

<!DOCTYPE html>
<html>
    <head>
        <title>Blueberry : GitLab and DevOps</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Blueberry</a></span>
                            </li>
                                                    <li>
                                <span><a href="DevOps-Information_36144018.html">DevOps Information</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Blueberry : GitLab and DevOps
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Duncan Forsyth</span>, last modified by <span class='editor'> Unknown User (ahk)</span> on Aug 21, 2017
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p>Projects should be set up as follows.</p><div class="table-wrap"><table class="relative-table confluenceTable" style="width: 94.1854%;"><colgroup><col style="width: 11.3054%;"/><col style="width: 14.2191%;"/><col style="width: 6.00233%;"/><col/><col style="width: 7.22611%;"/><col style="width: 61.2471%;"/></colgroup><tbody><tr><th class="confluenceTh">Environment</th><th class="confluenceTh">Domain</th><th class="confluenceTh">Git Branch</th><th colspan="1" class="confluenceTh"><p>Environment Variable</p></th><th colspan="1" class="confluenceTh">Pushed/Merged into by</th><th colspan="1" class="confluenceTh">Notes</th></tr><tr><td colspan="1" class="confluenceTd">-</td><td colspan="1" class="confluenceTd">-</td><td colspan="1" class="confluenceTd">&lt;PTS number&gt;</td><td colspan="1" class="confluenceTd">Development</td><td colspan="1" class="confluenceTd">All developers</td><td colspan="1" class="confluenceTd"><p>Developers should typically make one branch per PTS task. They should include the PTS number in the name. These branches are called 'feature' branches. They are branched from the &quot;develop&quot; branch (see below), and merged back into the &quot;develop&quot; branch. PTS tasks are expected to be small - less than 2-3 man days work, so these branches should not exist for long. They should be removed when they are merged back into develop.</p><p>We should try and avoid developing multiple tasks in the same feature branch, but this is not strictly ruled out. A rare issue that is expected to take several days work should also be worked on in a feature branch.</p><p>Typically, only a single developer will work on a feature branch. But that's not a rule set in stone.</p></td></tr><tr><td class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td><td class="confluenceTd">develop</td><td colspan="1" class="confluenceTd">Development (not yet in use)</td><td colspan="1" class="confluenceTd">All developers</td><td colspan="1" class="confluenceTd"><p>Quick issue fixes can be applied directly to the development branch without creating a feature branch. Doing so risks merge conflicts so please do consider the other developers on your team.</p></td></tr><tr><td colspan="1" class="confluenceTd"><span>Internal Test</span></td><td colspan="1" class="confluenceTd"><p><span style="color: rgb(0,51,102);">&lt;project&gt;-test-&lt;platform&gt;-&lt;dbtype&gt;.blueberrytest.com</span></p></td><td colspan="1" class="confluenceTd">test</td><td colspan="1" class="confluenceTd">test-&lt;platform&gt;-&lt;dbtype&gt;</td><td colspan="1" class="confluenceTd">See notes</td><td colspan="1" class="confluenceTd"><p><span>Where our PMs and tester view the work and feedback to developers. Pushing/Merging to this branch will cause deployment to test servers.</span></p><p><span><span>Some PMs will choose to restrict who may push/merge to create control over the test environment. This is done by &quot;protecting&quot; the branch in Gitlab. See below for more details. Other PMs will allow all developers to push to the the test environment so as not introduce additional lead time between a fix and its availability for testing. </span><br/></span></p></td></tr><tr><td class="confluenceTd">External Test / User Acceptance Test (<u><strong>optional</strong></u>)</td><td class="confluenceTd">&lt;project&gt;-uat.blueberrytest.com</td><td class="confluenceTd">uat</td><td colspan="1" class="confluenceTd">uat</td><td colspan="1" class="confluenceTd">PM / technical lead only</td><td colspan="1" class="confluenceTd">Some projects will have a separate site where the customers check over the Blueberry tested work before paying invoices. Its important that we're not constantly breaking this with new work, so it needs a separate branch than &quot;develop&quot;.</td></tr><tr><td colspan="1" class="confluenceTd">Staging (<u><strong>optional and rare</strong></u>)</td><td colspan="1" class="confluenceTd"><p><span style="color: rgb(0,51,102);">&lt;project&gt;-staging<span style="color: rgb(0,51,102);">.blueberrytest.com</span></span></p></td><td colspan="1" class="confluenceTd">staging</td><td colspan="1" class="confluenceTd">staging</td><td colspan="1" class="confluenceTd"><span>PM / technical lead only</span></td><td colspan="1" class="confluenceTd"><span>Staging environments are used where we want to test the deployment process itself. </span></td></tr><tr><td class="confluenceTd">Live / Production</td><td class="confluenceTd"><p>&lt;project&gt;.blueberrytest.com</p><p>&lt;project&gt;-master-&lt;platform&gt;-&lt;dbtype&gt;.blueberrytest.com</p></td><td class="confluenceTd">master</td><td colspan="1" class="confluenceTd">master-&lt;platform&gt;-&lt;dbtype&gt;</td><td colspan="1" class="confluenceTd"><span>PM / technical lead only</span></td><td colspan="1" class="confluenceTd"><span style="color: rgb(0,51,102);">The specified domain name merely used initially, until customer chooses a d</span><span>omain: </span></td></tr></tbody></table></div><p>Just as with SVN, developers should backup their work to the server once a day - even if the work is not completed. We ask only that work do not break the build for other developers. For GitLab this means <em>pushing</em> their work to GitLab.</p><p>The roles on a project in GitLab are: owner, master, developer, guest, reporter. &quot;Protected&quot; branches can only receive a push or merge from users with the project role 'master'. It is important that the branches &quot;uat&quot;, &quot;staging&quot;, and &quot;master&quot; are marked in GitLab as protected branches. This is how the PM controls deployment to customer-facing release environments. Only the PM, an APM, perhaps one technical lead, should have the 'master' role. To protect a branch please see: <a class="external-link" href="https://docs.gitlab.com/ee/user/project/protected_branches.html#configuring-protected-branches" rel="nofollow">https://docs.gitlab.com/ee/user/project/protected_branches.html#configuring-protected-branches</a> .</p><p>Without that degree of restriction a PM can't speak to the customer with confidence about what the customer can expect to see on &quot;their&quot; sites.</p><p>Most projects will only have feature branches, a develop branch, a test branch, and a master branch.</p><p><strong>Comparison to SVN</strong></p><p>If you're coming from an SVN background</p><ul><li>Yes, a push is like an SVN commit.</li><li>Yes, branching and merging is (claimed to be) so easy that normal development is expected to use a branch for each item of work.</li><li>Yes, the develop branch is a bit like trunk.</li><li>Yes, the master branch is a bit like either tagged releases or an SVN 'release' branch, if you used either of them. Many SVN-based projects used neither.</li><li>Yes, separating 'test' and 'master' branches has rarely been implemented on SVN projects.</li></ul><p><strong>The Continuous Integration Scripts</strong></p><p>A push or merge to any of those branches can cause GitLab CI scripts to run. The GitLab scripts are in the root of your branch and called &quot;.gitlab-ci.yml&quot;. The scripts contain rules about all the branches, but explicitly say &quot;if I'm being run as a result to an X branch push do A, B, and C, but not D&quot;.</p><p>We're not fully rolled out on the features below.</p><p>Feature branches:</p><ul><li>No build, no tests, no deployment, no SonarQube analysis, no publishing of test report pages<em><span style="color: rgb(51,51,51);"><br/></span></em></li><li><em>Perhaps later: build and test, with tests emailed rather that published </em><span style="color: rgb(192,192,192);"><br/></span></li></ul><p>Develop branch:</p><ul><li><em>Currently inconsistent between VME and BBWT3 but soon: </em>No build, no tests, no deployment, no SonarQube analysis, no publishing of test report pages</li><li><em>Perhaps later: build and test, SonarQube analysis, publishing of test report pages, but no deployment</em><em><span style="color: rgb(51,51,51);"><br/></span></em></li></ul><p><span style="color: rgb(192,192,192);"><span style="color: rgb(51,51,51);">All other branches:</span></span></p><ul><li>Build <em>(soon to build for the appropriate target environment)</em>. <em>Planned for much later: Builds are executed on servers other than the GitLab server.</em></li><li>Pre-deployment tests, <em>soon to include code coverage metrics</em>, <em>soon to </em><span style="color: rgb(51,51,51);"><em>merge tests into one report</em></span>, publish test report pages (<em>soon <em>to </em>branch-specific pages)</em>, perform SonarQube analysis, and report it against a (<em>soon branch-specific)</em> SonarQube project.</li><li>If the tests pass, deploy. <em>Later: Deployment should be friendly and should not present errors to end-users.</em> If the tests don't pass, there is an option for the PM / Technical Lead to manually deploy.</li><li><em>Planned for later: Post-deployment tests.</em></li><li><em><em>Perhaps l</em>ater: For Internal Test, we prompt testers to tell them a new release has been deployed and perhaps what changes it contains.</em></li><li><em><em>Perhaps l</em>ater: With more R&amp;D, we trigger some process that leads to periodic application vulnerability testing (The CI server does not know about OS changes – patches – so we can’t prompt for OS-level vulnerability scans from CI)</em><em><br/></em></li></ul><p>See <a href="38175045.html">Application's Environment Configuration</a> for details on how an application configures itself to run on the correct target environment.</p><p><strong>Developer Support for CI Scripts</strong></p><p>CI scripts are run by GitLab-runner. The GitLab-runner can make use of Docker to ensure that the scripts are run against the same configuration each time. <em>Soon: We specify specific packages and images rather than the &quot;latest&quot;.</em></p><p>It is important that developers can fix problems with the CI scripts, and that it doesn't become a sysadmin responsibility to debug and fix builds. That means they need to be able to interactively work with Docker Containers, ideally on their own machines rather than on the GitLab server. </p><p>We are not insisting that developers should run normal local builds using the CI scripts. This is likely difficult and has only minor benefits.</p><p>The GitLab server is currently running on Linux. This means that it can only run Linux Docker Containers. This has implications for what a developer's Docker setup should be. See the <a href="Docker_37062673.html">Docker&nbsp;</a>page for more details. The developer does not need to have a Linux machine.</p><p><strong>GitLab, Platforms, and BBWT3</strong></p><p>BBWT3 is intended to be cross-platform for deployment. We are not planning for the CI scripts to be cross-platform. </p><p>Currently BBWT3 pre-deployment tests can be executed cross-platform. Even if other things change, it would remain very useful to keep that feature intact.</p><p>Currently BBWT3 and VME are on Windows/SQL Server. <em>BBWT3 will soon be targetting Linux/Aurora.</em></p><p><em><br/></em></p>
                    </div>

                    
                 
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Dec 03, 2020 14:51</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
