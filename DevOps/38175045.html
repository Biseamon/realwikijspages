<!--
title: Application's Environment Configuration
description: 
published: true
date: 2020-12-03T15:06:11.542Z
tags: 
editor: ckeditor
dateCreated: 2020-12-03T14:57:54.279Z
-->

<h1>Blueberry : Application's Environment Configuration&nbsp;</h1>
<p>Created by Duncan Forsyth, last modified on Jul 24, 2017</p>
<p>When the application runs, it needs to know:</p>
<ul>
  <li>Which database to connect to</li>
  <li>Whether to enable caching</li>
  <li>Whether to ensure all client-side resources are bundled, minified&nbsp;<i>(and potentially served from a CDN)</i></li>
  <li>Whether to use technical diagnostic&nbsp;error pages&nbsp;or friendly error pages</li>
  <li>What level of logging and monitoring to use</li>
</ul>
<p>The application uses the environment variable&nbsp;ASPNETCORE_ENVIRONMENT to decide how to behave. You can read more about the environment variable at&nbsp;<a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/environments">https://docs.microsoft.com/en-us/aspnet/core/fundamentals/environments</a>&nbsp;. Note well: the example values described in the Microsoft link are not the ones we're using to support BBWT3.</p>
<h2>How the environment variable is set</h2>
<h3>On a development machine</h3>
<p>On a development machine you can set the value at System or User level in your OS.</p>
<figure class="image"><img src="attachments/38175045/38175046.png"></figure>
<p>Or you can specify it in Web project properties when using Visual Studio.</p>
<figure class="image"><img src="attachments/38175045/38175047.png"></figure>
<p>Or if you're using VS Code, you can specify it in .vscode/launch.json&nbsp;</p>
<figure class="image"><img src="attachments/38175045/38175048.png"></figure>
<h3>On elastic beanstalk</h3>
<p>On elastic beanstalk, due to an Amazon bug, we cannot <i>directly</i> set the environment variables. But we can set environment "properties" and with a bit of code in Startup.cs we can read the environment properties and write them into the environment variables.&nbsp;</p>
<p>As part of the DevOps process, the environment named "master" will have the environment property ASPNETCORE_ENVIRONMENT&nbsp;set to the value "master" and the environment named "test" will have the value as "test".</p>
<p>&nbsp;</p>
<h2>Configuration Files</h2>
<p>One of the important things we do with the environment variable is decide which configuration we're going to load from the configuration files.</p>
<ul>
  <li><i>appsettings.json</i>&nbsp;– should contain configuration elements that are the same for all our environments. It will not have database connections in it - because developers will certainly not be using the same database as the test and live environments</li>
</ul>
<p>And then we load one of the following, depending on the value of the environment variable&nbsp;ASPNETCORE_ENVIRONMENT</p>
<ul>
  <li><i>appsettings.development.json</i>&nbsp;– the developer's configuration with specific connection strings for his machine. <strong>Don't push this to GitLab.</strong></li>
  <li><i>appsettings.test.json</i>&nbsp;– the configuration for the test server</li>
  <li><i>appsettings.master.json</i>&nbsp;– the configuration for the master server (the master server is deployed to when pushes are made to the master branch of GitLab)</li>
</ul>
<p>Worth nothing:</p>
<ul>
  <li><i>appsettings.development.json.template</i>&nbsp;– the template file you can use to create your own development config.</li>
</ul>
<p>&nbsp;</p>
<p>Note well: appsettings.{env.EnvironmentName}.json file is able to either <strong>add</strong> new config sections or <strong>overwrite</strong> values. Configuration depends on the combination of the two files loaded into the app.</p>
<p>&nbsp;</p>
<h2>Known 'gotchas'</h2>
<p>Visual Studio creates a file with a couple of profiles for running your application either via IIS Express or directly as a console application.</p>
<p>Please ensure you don’t have a specific override in Properties/launchSettings.json file for your profile.</p>
<h2>Attachments:</h2>
<figure class="image"><img src="images/icons/bullet_blue.gif" alt=""></figure>
<p><a href="attachments/38175045/38175046.png">OS.png</a> (image/png)&nbsp;<br>&nbsp;</p>
<figure class="image"><img src="images/icons/bullet_blue.gif" alt=""></figure>
<p><a href="attachments/38175045/38175047.png">Visual Studio.png</a> (image/png)&nbsp;<br>&nbsp;</p>
<figure class="image"><img src="images/icons/bullet_blue.gif" alt=""></figure>
<p><a href="attachments/38175045/38175048.png">VSCODE.png</a> (image/png)&nbsp;<br>&nbsp;</p>
<p>Document generated by Confluence on Dec 03, 2020 14:51</p>
<p><a href="http://www.atlassian.com/">Atlassian</a></p>
